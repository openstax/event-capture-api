{
  "swagger": "2.0",
  "info": {
    "version": "0.1.0",
    "title": "OpenStax Event Capture API",
    "description": "The Event Capture API for OpenStax.\n\nRequests to this API should include `application/json` in the `Accept` header.\n\nThe desired API version is specified in the request URL, e.g. `[domain]/api/v0`. While the API does support a default version, that version will change over time and therefore should not be used in production code!\n",
    "termsOfService": "https://openstax.org/tos",
    "contact": {
      "name": "support@openstax.org"
    },
    "license": {
      "name": "MIT"
    }
  },
  "tags": [
    {
      "name": "Event Capture",
      "description": "Event Capture endpoints"
    }
  ],
  "basePath": "/api/v0",
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/events": {
      "post": {
        "summary": "Captures events",
        "description": "Capture one or more events",
        "operationId": "addEvents",
        "produces": [
          "application/json"
        ],
        "tags": [
          "Events"
        ],
        "parameters": [
          {
            "name": "payload",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/Events"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Created."
          }
        }
      }
    },
    "/info": {
      "get": {
        "summary": "Get info on event capture",
        "description": "Get info on event capture",
        "operationId": "info",
        "produces": [
          "application/json"
        ],
        "tags": [
          "Info"
        ],
        "responses": {
          "200": {
            "description": "Success.  Returns basic event capture metrics.",
            "schema": {
              "$ref": "#/definitions/InfoResults"
            }
          },
          "500": {
            "description": "Server error.",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/xapi/statements": {
      "put": {
        "summary": "Stores a single Statement with the given id.",
        "description": "Stores a single `Statement` with the given id. POST can also be used to store single Statements.",
        "parameters": [
          {
            "name": "method",
            "in": "query",
            "type": "string",
            "description": "a MUST",
            "default": "PUT",
            "required": true
          },
          {
            "name": "statementId",
            "type": "string",
            "in": "query",
            "description": "Id of Statement to record",
            "required": true
          },
          {
            "name": "content",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/Statement"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Default response",
            "headers": {
              "X-Experience-API-Consistent-Through": {
                "type": "string",
                "format": "date-time",
                "description": "The LRS MUST include this header on all responses to Statements Resource requests."
              }
            }
          },
          "409": {
            "description": "If the LRS receives a Statement with an id it already has a Statement for, it SHOULD verify the received Statement matches the existing one and SHOULD return 409 Conflict if they do not match. See Statement comparison requirements.",
            "headers": {
              "X-Experience-API-Consistent-Through": {
                "type": "string",
                "format": "date-time",
                "description": "The LRS MUST include the header \"X-Experience-API-Consistent-Through\" on all responses to Statements Resource requests."
              }
            }
          },
          "400": {
            "description": "If the LRS receives a batch of Statements containing two or more Statements with the same id, it SHOULD* reject the batch and return 400 Bad Request.",
            "headers": {
              "X-Experience-API-Consistent-Through": {
                "type": "string",
                "format": "date-time",
                "description": "The LRS MUST include the header \"X-Experience-API-Consistent-Through\" on all responses to Statements Resource requests."
              }
            }
          }
        }
      },
      "post": {
        "summary": "Stores a Statement, or a set of Statements.",
        "description": "Stores a Statement, or a set of Statements.",
        "parameters": [
          {
            "name": "content",
            "in": "body",
            "required": true,
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Statement"
              }
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Default response",
            "headers": {
              "X-Experience-API-Consistent-Through": {
                "type": "string",
                "format": "date-time",
                "description": "The LRS MUST include the header \"X-Experience-API-Consistent-Through\" on all responses to Statements Resource requests."
              }
            }
          },
          "400": {
            "description": "If the LRS receives a batch of Statements containing two or more Statements with the same id, it SHOULD* reject the batch and return 400 Bad Request.",
            "headers": {
              "X-Experience-API-Consistent-Through": {
                "type": "string",
                "format": "date-time",
                "description": "The LRS MUST include the header \"X-Experience-API-Consistent-Through\" on all responses to Statements Resource requests."
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "Error": {
      "properties": {
        "status_code": {
          "type": "integer",
          "description": "The HTTP status code"
        },
        "messages": {
          "type": "array",
          "description": "The error messages, if any",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "Event": {
      "required": [
        "data"
      ],
      "properties": {
        "data": {
          "type": "object",
          "description": "The event object.  Will be of a type that lives in a swagger file inside the schemas directory."
        }
      }
    },
    "Events": {
      "properties": {
        "events": {
          "type": "array",
          "description": "Array of Event",
          "items": {
            "$ref": "#/definitions/Event"
          }
        }
      }
    },
    "InfoData": {
      "properties": {
        "kafka_topics": {
          "type": "array",
          "description": "Topics in the kafka cluster",
          "items": {
            "type": "string"
          }
        },
        "schema_registry_subjects": {
          "type": "array",
          "description": "Subjects in the schema registry",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "InfoResults": {
      "properties": {
        "overall_took_ms": {
          "type": "integer",
          "readOnly": true,
          "description": "How long the request took (ms)"
        },
        "env_name": {
          "type": "string",
          "readOnly": true,
          "description": "Name of deployed environment"
        },
        "accounts_env_name": {
          "type": "string",
          "readOnly": true,
          "description": "Accounts environment name"
        },
        "ami_id": {
          "type": "string",
          "readOnly": true,
          "description": "Amazon machine image id"
        },
        "git_sha": {
          "type": "string",
          "readOnly": true,
          "description": "Git sha"
        },
        "data": {
          "$ref": "#/definitions/InfoData"
        }
      }
    },
    "Actor": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the actor."
        },
        "account": {
          "type": "object",
          "required": [
            "homePage",
            "name"
          ],
          "properties": {
            "homePage": {
              "type": "string",
              "description": "The URL of the actor's home page."
            },
            "name": {
              "type": "string",
              "description": "The account name or handle."
            }
          }
        }
      }
    },
    "Verb": {
      "type": "object",
      "required": [
        "id"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "The unique identifier of the verb."
        },
        "display": {
          "type": "object",
          "required": [
            "en"
          ],
          "properties": {
            "en": {
              "type": "string",
              "description": "The verb display name in English."
            }
          }
        }
      }
    },
    "Object": {
      "type": "object",
      "required": [
        "id"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "The unique identifier of the object."
        },
        "definition": {
          "type": "object",
          "properties": {
            "name": {
              "type": "object",
              "required": [
                "en"
              ],
              "properties": {
                "en": {
                  "type": "string",
                  "description": "The object display name in English."
                }
              }
            }
          }
        }
      }
    },
    "Result": {
      "type": "object",
      "properties": {
        "score": {
          "type": "object",
          "required": [
            "raw"
          ],
          "properties": {
            "raw": {
              "type": "number",
              "description": "The raw score value."
            }
          }
        }
      }
    },
    "Statement": {
      "type": "object",
      "required": [
        "actor",
        "verb",
        "object"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "The unique identifier of the statement."
        },
        "actor": {
          "$ref": "#/definitions/Actor",
          "description": "The actor who performed the action described in the statement."
        },
        "verb": {
          "$ref": "#/definitions/Verb",
          "description": "The action performed by the actor."
        },
        "object": {
          "$ref": "#/definitions/Object",
          "description": "The object or target of the action."
        },
        "context": {
          "$ref": "#/definitions/Context",
          "description": "The context in which the statement occurred."
        },
        "result": {
          "$ref": "#/definitions/Result",
          "description": "The result or outcome of the action."
        },
        "timestamp": {
          "type": "string",
          "format": "date_time",
          "description": "The timestamp when the statement was made."
        },
        "attachments": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Attachment"
          },
          "description": "Any attachments associated with the statement."
        },
        "authority": {
          "$ref": "#/definitions/Agent",
          "description": "The authority or source of the statement."
        },
        "version": {
          "type": "string",
          "description": "The version of the xAPI specification."
        }
      }
    },
    "Statements": {
      "properties": {
        "statements": {
          "type": "array",
          "description": "Array of Statement",
          "items": {
            "$ref": "#/definitions/Statement"
          }
        }
      }
    },
    "AccessedStudyguideV1": {
      "properties": {
        "client_clock_occurred_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event actually occurred."
        },
        "client_clock_sent_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event was sent to the server."
        },
        "type": {
          "type": "string",
          "description": "The data's type.",
          "enum": [
            "org.openstax.ec.accessed_studyguide_v1"
          ]
        },
        "source_uri": {
          "type": "string",
          "description": "client location when event occurred."
        },
        "session_uuid": {
          "type": "string",
          "format": "uuid",
          "description": "The UUID of the current session, previously generated by the client and submitted in a \"session started\" event."
        },
        "session_order": {
          "type": "integer",
          "description": "The event's numerical order within this session. E.g. the first event after a session is started should give 0 for this field, the next one should give 1, etc."
        },
        "page_id": {
          "type": "string",
          "description": "The page id."
        },
        "book_id": {
          "type": "string",
          "description": "The book id."
        },
        "source_metadata": {
          "type": "object",
          "description": "The ids and versions needed to retrieve the original source that was interacted with",
          "required": [
            "content_id",
            "content_version"
          ],
          "properties": {
            "content_id": {
              "type": "string",
              "description": "ID of content visible when this event occurred."
            },
            "content_version": {
              "type": "string",
              "description": "Version of the content"
            },
            "context_version": {
              "type": "string",
              "description": "Version that impacts the source content, but is not revision of the content itself, such as a versioned api, or content pipeline"
            },
            "content_index": {
              "type": "integer",
              "description": "Zero based index of this content in its parent list, if any exists."
            },
            "scope_id": {
              "type": "string",
              "description": "ID for the larger scope of this content"
            }
          }
        }
      },
      "required": [
        "page_id",
        "book_id",
        "client_clock_sent_at",
        "client_clock_occurred_at",
        "type",
        "source_uri",
        "session_uuid",
        "session_order"
      ]
    },
    "ChangedStateV1": {
      "properties": {
        "client_clock_occurred_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event actually occurred."
        },
        "client_clock_sent_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event was sent to the server."
        },
        "type": {
          "type": "string",
          "description": "The data's type.",
          "enum": [
            "org.openstax.ec.changed_state_v1"
          ]
        },
        "source_uri": {
          "type": "string",
          "description": "client location when event occurred."
        },
        "session_uuid": {
          "type": "string",
          "format": "uuid",
          "description": "The UUID of the current session, previously generated by the client and submitted in a \"session started\" event."
        },
        "session_order": {
          "type": "integer",
          "description": "The event's numerical order within this session. E.g. the first event after a session is started should give 0 for this field, the next one should give 1, etc."
        },
        "state_type": {
          "type": "string",
          "description": "The type of state that is changing, e.g. visibility"
        },
        "current": {
          "type": "string",
          "description": "The current value for the state described by :state_type"
        },
        "previous": {
          "type": "string",
          "description": "The previous value for the state described by :state_type"
        },
        "source_metadata": {
          "type": "object",
          "description": "The ids and versions needed to retrieve the original source that was interacted with",
          "required": [
            "content_id",
            "content_version"
          ],
          "properties": {
            "content_id": {
              "type": "string",
              "description": "ID of content visible when this event occurred."
            },
            "content_version": {
              "type": "string",
              "description": "Version of the content"
            },
            "context_version": {
              "type": "string",
              "description": "Version that impacts the source content, but is not revision of the content itself, such as a versioned api, or content pipeline"
            },
            "content_index": {
              "type": "integer",
              "description": "Zero based index of this content in its parent list, if any exists."
            },
            "scope_id": {
              "type": "string",
              "description": "ID for the larger scope of this content"
            }
          }
        }
      },
      "required": [
        "state_type",
        "current",
        "previous",
        "client_clock_sent_at",
        "client_clock_occurred_at",
        "type",
        "source_uri",
        "session_uuid",
        "session_order"
      ]
    },
    "CreatedHighlightV1": {
      "properties": {
        "client_clock_occurred_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event actually occurred."
        },
        "client_clock_sent_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event was sent to the server."
        },
        "type": {
          "type": "string",
          "description": "The data's type.",
          "enum": [
            "org.openstax.ec.created_highlight_v1"
          ]
        },
        "source_uri": {
          "type": "string",
          "description": "client location when event occurred."
        },
        "session_uuid": {
          "type": "string",
          "format": "uuid",
          "description": "The UUID of the current session, previously generated by the client and submitted in a \"session started\" event."
        },
        "session_order": {
          "type": "integer",
          "description": "The event's numerical order within this session. E.g. the first event after a session is started should give 0 for this field, the next one should give 1, etc."
        },
        "highlight_id": {
          "type": "string",
          "description": "The highlight id."
        },
        "source_type": {
          "type": "string",
          "description": "The highlight source type (e.g., openstax_page)."
        },
        "source_id": {
          "type": "string",
          "description": "The highlight source id (e.g., page uuid)."
        },
        "source_metadata": {
          "type": "object",
          "description": "The highlight source metadata."
        },
        "annotation": {
          "type": "string",
          "description": "The highlight annotation."
        },
        "anchor": {
          "type": "string",
          "description": "The highlight anchor."
        },
        "color": {
          "type": "string",
          "description": "The highlight color."
        },
        "location_strategies": {
          "type": "string",
          "description": "The highlight location strategies (e.g., a text position selector)."
        },
        "scope_id": {
          "type": "string",
          "description": "The highlight location scope (container for the source, like a book uuid)."
        }
      },
      "required": [
        "highlight_id",
        "source_type",
        "source_id",
        "source_metadata",
        "anchor",
        "annotation",
        "color",
        "location_strategies",
        "scope_id",
        "client_clock_sent_at",
        "client_clock_occurred_at",
        "type",
        "source_uri",
        "session_uuid",
        "session_order"
      ]
    },
    "CreatedHighlightV2": {
      "properties": {
        "client_clock_occurred_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event actually occurred."
        },
        "client_clock_sent_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event was sent to the server."
        },
        "type": {
          "type": "string",
          "description": "The data's type.",
          "enum": [
            "org.openstax.ec.created_highlight_v2"
          ]
        },
        "source_uri": {
          "type": "string",
          "description": "client location when event occurred."
        },
        "session_uuid": {
          "type": "string",
          "format": "uuid",
          "description": "The UUID of the current session, previously generated by the client and submitted in a \"session started\" event."
        },
        "session_order": {
          "type": "integer",
          "description": "The event's numerical order within this session. E.g. the first event after a session is started should give 0 for this field, the next one should give 1, etc."
        },
        "highlight_id": {
          "type": "string",
          "description": "The highlight id."
        },
        "source_type": {
          "type": "string",
          "description": "The highlight source type (e.g., openstax_page)."
        },
        "anchor": {
          "type": "string",
          "description": "The highlight anchor."
        },
        "color": {
          "type": "string",
          "description": "The highlight color."
        },
        "location_strategies": {
          "type": "string",
          "description": "The highlight location strategies (e.g., a text position selector)."
        },
        "source_metadata": {
          "type": "object",
          "description": "The ids and versions needed to retrieve the original source that was interacted with",
          "required": [
            "content_id",
            "content_version"
          ],
          "properties": {
            "content_id": {
              "type": "string",
              "description": "ID of content visible when this event occurred."
            },
            "content_version": {
              "type": "string",
              "description": "Version of the content"
            },
            "context_version": {
              "type": "string",
              "description": "Version that impacts the source content, but is not revision of the content itself, such as a versioned api, or content pipeline"
            },
            "content_index": {
              "type": "integer",
              "description": "Zero based index of this content in its parent list, if any exists."
            },
            "scope_id": {
              "type": "string",
              "description": "ID for the larger scope of this content"
            }
          }
        }
      },
      "required": [
        "highlight_id",
        "source_type",
        "source_metadata",
        "anchor",
        "color",
        "location_strategies",
        "client_clock_sent_at",
        "client_clock_occurred_at",
        "type",
        "source_uri",
        "session_uuid",
        "session_order"
      ]
    },
    "InteractedElementV1": {
      "properties": {
        "client_clock_occurred_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event actually occurred."
        },
        "client_clock_sent_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event was sent to the server."
        },
        "type": {
          "type": "string",
          "description": "The data's type.",
          "enum": [
            "org.openstax.ec.interacted_element_v1"
          ]
        },
        "source_uri": {
          "type": "string",
          "description": "client location when event occurred."
        },
        "session_uuid": {
          "type": "string",
          "format": "uuid",
          "description": "The UUID of the current session, previously generated by the client and submitted in a \"session started\" event."
        },
        "session_order": {
          "type": "integer",
          "description": "The event's numerical order within this session. E.g. the first event after a session is started should give 0 for this field, the next one should give 1, etc."
        },
        "target_id": {
          "type": "string",
          "description": "The target element id."
        },
        "target_type": {
          "type": "string",
          "description": "The target element (interactive) type."
        },
        "target_attributes": {
          "type": "object",
          "description": "The target element attributes (map, all attributes)."
        },
        "target_state_change": {
          "type": "string",
          "description": "The target element state change that triggered event, if any."
        },
        "context_id": {
          "type": "string",
          "description": "The context element id for the target element (likely a parent: eg: if target is a solution, context would be problem)."
        },
        "context_type": {
          "type": "string",
          "description": "The context element (parent) type."
        },
        "context_attributes": {
          "type": "object",
          "description": "The context element attributes (map, all useful attributes)."
        },
        "context_region": {
          "type": "string",
          "description": "The UX region the context element is in (e.g. toc, header, page)."
        },
        "source_metadata": {
          "type": "object",
          "description": "The ids and versions needed to retrieve the original source that was interacted with",
          "required": [
            "content_id",
            "content_version"
          ],
          "properties": {
            "content_id": {
              "type": "string",
              "description": "ID of content visible when this event occurred."
            },
            "content_version": {
              "type": "string",
              "description": "Version of the content"
            },
            "context_version": {
              "type": "string",
              "description": "Version that impacts the source content, but is not revision of the content itself, such as a versioned api, or content pipeline"
            },
            "content_index": {
              "type": "integer",
              "description": "Zero based index of this content in its parent list, if any exists."
            },
            "scope_id": {
              "type": "string",
              "description": "ID for the larger scope of this content"
            }
          }
        }
      },
      "required": [
        "target_id",
        "target_type",
        "target_attributes",
        "context_id",
        "context_type",
        "context_attributes",
        "client_clock_sent_at",
        "client_clock_occurred_at",
        "type",
        "source_uri",
        "session_uuid",
        "session_order"
      ]
    },
    "NudgedV1": {
      "properties": {
        "client_clock_occurred_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event actually occurred."
        },
        "client_clock_sent_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event was sent to the server."
        },
        "type": {
          "type": "string",
          "description": "The data's type.",
          "enum": [
            "org.openstax.ec.nudged_v1"
          ]
        },
        "source_uri": {
          "type": "string",
          "description": "client location when event occurred."
        },
        "session_uuid": {
          "type": "string",
          "format": "uuid",
          "description": "The UUID of the current session, previously generated by the client and submitted in a \"session started\" event."
        },
        "session_order": {
          "type": "integer",
          "description": "The event's numerical order within this session. E.g. the first event after a session is started should give 0 for this field, the next one should give 1, etc."
        },
        "app": {
          "type": "string",
          "description": "The app sourcing the nudge (e.g., tutor."
        },
        "target": {
          "type": "string",
          "description": "The target of the nudge (e.g., study_guides)."
        },
        "context": {
          "type": "string",
          "description": "The nudge context (e.g., a book uuid)."
        },
        "flavor": {
          "type": "string",
          "description": "The nudge flavor (e.g., full screen v2)."
        },
        "medium": {
          "type": "string",
          "description": "The nudge medium (e.g., email)."
        }
      },
      "required": [
        "app",
        "target",
        "context",
        "flavor",
        "medium",
        "client_clock_sent_at",
        "client_clock_occurred_at",
        "type",
        "source_uri",
        "session_uuid",
        "session_order"
      ]
    },
    "StartedSessionV1": {
      "properties": {
        "client_clock_occurred_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event actually occurred."
        },
        "client_clock_sent_at": {
          "type": "string",
          "format": "date-time",
          "description": "The RFC 3339 section 5.6 date-time when event was sent to the server."
        },
        "type": {
          "type": "string",
          "description": "The data's type.",
          "enum": [
            "org.openstax.ec.started_session_v1"
          ]
        },
        "source_uri": {
          "type": "string",
          "description": "client location when event occurred."
        },
        "referrer": {
          "type": "string",
          "description": "The referrer."
        },
        "session_uuid": {
          "type": "string",
          "description": "The client generates this UUID and references it for all future events in this session."
        },
        "platform": {
          "type": "string",
          "description": "The platform name of the app (e.g. rex, kinetic)"
        },
        "release_id": {
          "type": "string",
          "description": "The code version of the app."
        },
        "service_worker": {
          "type": "string",
          "description": "The service worker state",
          "enum": [
            "unsupported",
            "inactive",
            "active"
          ]
        }
      },
      "required": [
        "referrer",
        "session_uuid",
        "client_clock_sent_at",
        "client_clock_occurred_at",
        "type",
        "source_uri",
        "session_uuid",
        "session_order"
      ]
    }
  }
}